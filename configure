#!/bin/bash

echo "Configuring Satellite"

#default log path
OS=`uname`
if [ "$OS" = "Darwin" ]; then
    logpath="/Users/`whoami`/.satellite/sat.log"
    #lets make a satellite folder just incase it doesn't exist
    mkdir -p /Users/`whoami`/.satellite
else
    logpath="/home/`whoami`/.satellite/sat.log"
    #lets make a satellite folder just incase it doesn't exist
    mkdir -p /home/`whoami`/.satellite
fi
echo "logpath set to: $logpath"

function check_deps()
{
OS=`uname`
if [ "$OS" = "Darwin" ]; then
	brew list | grep mysql 
	if [ $? -ne 0 ]; then
		brew install mysql-connector-c mysql
	fi
else
	echo "Unable to check mysql deps on linux system"
fi
}
function setup_conf()
{
    echo "sqlhost=$sqlhost" >> conf/satellite.conf
    echo "sqluser=$sqluser" >> conf/satellite.conf
    echo "sqlpass=$sqlpass" >> conf/satellite.conf
    echo "listenport=9099" >> conf/satellite.conf
    echo "logpath=$logpath" >> conf/satellite.conf
	echo "frontendserver=$frontend" >> conf/satellite.conf
    echo "frontendport=$frontendport" >> conf/satellite.conf
    echo "max_retries=5" >> conf/satellite.conf
}
function place_conf()
{
    if [ "$OS" = "Darwin" ]; then
        mv conf/satellite.conf /Users/`whoami`/.satellite
    else
        mv conf/satellite.conf /home/`whoami`/.satellite
    fi
}
if [ -e conf/satellite.conf ]; then
    rm conf/satellite.conf
fi
if [ -e Makefile ]; then
    rm Makefile
fi
if [ -e isotope ]; then
    rm isotope
fi

cat Makefile.in | while IFS='' read -r LINE
do
    echo "$LINE" >> Makefile
done
check_deps
setup_conf
place_conf
echo "All done!"
echo "Please run make"
